# 第3章：関数型アーキテクチャ
本章では、以下について記述されている
* 関数型ドメインモデルの典型的なソフトウェアアーキテクチャ
* DDDの概念である境界付けられたコンテキストやドメインイベントをソフトウェアにどのように変換するか

## 用語

|用語|説明|
|---|---|
|システムコンテキスト|システム全体を表す最上位の概念|
|コンテナ|システムコンテキストを構成する単位<br>Webサイト・サービス、データベースをデプロイ可能|
|コンポーネント|コンテナを構成する単位<br>コードの構成において主要な構成要素|
|クラス|コンポーネントを構成する単位<br>低レベルのメソッドや関数の集合など|

[イメージ]

![](img\img1.dio.svg)

## 3.1 自立したソフトウェアコンポーネントとしても境界づけられたコンテキスト
### 「境界づけられたコンテキスト」の概念とは？
* コンテキストは<u>自律的な</u>サブシステム
* <u>明確に定義された境界</u>を持つ

### 一般的なアーキテテクチャのスタイルの例
一般的なアーキテクチャのスタイルに対して、「境界付けられたコンテキスト」はどこに当たるのか

* システム全体が単一のモノリシックなデプロイ単位(=単一のコンテナ)  
  ↓本著からの抜粋  
  ```
  境界付けられたコンテキストは、明確に定義されたインターフェイスを持つ独立したモジュールのように単純なものになるかもしれません  
  ```
  システム内のモジュールに対して境界づけられたコンテキストは存在するが、それぞれが独立してデプロイはできない
  
  > [!INFO]  
  > モノリシック = 一体化した、という意味を示し、アーキテクチャの文脈においてはシステム全体が一つの大きなプログラムとして構築されている設計を指す

* 古典的なサービス指向のアーキテクチャ  
  ↓本著からの抜粋
  ```
  また、境界づけられたコンテキストの単位で、専用のコンテナに個別にデプロイもできます。
  これは古典的なサービス指向アーキテクチャの姿です。
  ```
  「注文管理」というサービスに含まれる「決済」や「在庫管理」も含めて一つの単位として境界づけられたコンテキストとして定義する

* マイクロサービスアーキテクチャ  
  ↓本著からの抜粋
  ```
  さらに細分化して、ワークフローを独立してデプロイ可能なコンテナの単位にもできます。
  こちらはマイクロサービスアーキテクチャです
  ```
  サービスの中でさらに細分化された単位に対して境界づけられたコンテキストが存在する
  例えば「注文管理」というサービスの中にある「決済」や「在庫単位」がそれぞれ独立して動作する状態
  
➡ 特定のアプローチに拘る必要はない  
➡ 論理的な設計からデプロイ可能な形式への変換は重要ではない

### 適切な境界の設定
プロジェクトの初期段階で適切な境界を設けることは難しい  
* ドメインについての知識が深まるについて境界も変化していくものと想定するべき  
* モノリス（＝システム全体が一つの大きなプログラムとして構築されている設計）はリファクタリングが容易なため、最初はモノリスとしてシステムを構築
* 必要に応じて疎結合コンテナにリファクタリングするのがよい方法

> [!WARN]  
> マイクロサービスに飛びついて運用上の余分な負担を書ける必要はない  
> 真に疎結合なマイクロサービスアーキテクチャを実現するのは容易なことではない  
> マイクロサービス間で依存してしまう状態になると、結局モノリシックなシステムが分散されているだけの状態にすぎない